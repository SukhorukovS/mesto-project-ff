(()=>{"use strict";var t;function e(t){"Escape"===t.key&&r(),t.target.classList.contains("popup__close")&&r(),t.target.classList.contains("popup")&&r()}function n(n){(t=document.querySelector(".popup_type_".concat(n))).classList.add("popup_is-opened"),t.addEventListener("click",e),document.addEventListener("keydown",e)}function r(){t.classList.remove("popup_is-opened"),t.removeEventListener("click",e),document.removeEventListener("keydown",e)}function o(t,e){var n=e.inputSelector,r=e.inputErrorClass,o=e.submitButtonSelector,i=e.errorSelector,c=e.inactiveButtonClass,u=Array.from(t.querySelectorAll(n));u.forEach(function(t){t.classList.remove(r),t.setCustomValidity("")}),Array.from(t.querySelectorAll(i)).forEach(function(t){return t.textContent=""});var l=t.querySelector(o);a(u,l,c)}var i=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add("popup__input_type_error"),r.textContent=n,r.classList.add("popup__input-error_active")},c=function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""},a=function(t,e,n){!function(t){return t.some(function(t){return!t.validity.valid})}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))},u={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorSelector:".popup__input-error"};function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){f(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function f(t,e,n){return(e=function(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var p={authorization:"ec643d58-8d20-44e7-9012-854c26080b1f",Accept:"application/json","Content-Type":"application/json"};function m(t){var e=t.url,n=t.method,r=t.headers,o=t.body;return fetch("".concat("https://nomoreparties.co/v1/higher-front-back-dev").concat(e),{method:n,headers:d(d({},p),r),body:o}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}var v=document.querySelector("#card-template").content.querySelector(".places__item"),y=document.querySelector(".places__list"),_=document.forms["new-place"],b=_.elements["place-name"],h=_.elements.link,S=document.forms["delete-card"],g=S.elements["delete-button"];function k(t){var e,n=t.data,r=t.profileId,o=t.onDelete,i=t.onLike,c=t.onPhotoClick,a=v.cloneNode(!0),u=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button");l.dataset.cardId=n._id,n.likes.some(function(t){return t._id===r})&&l.classList.add("card__like-button_is-active");var s,d=a.querySelector(".card__image"),f=a.querySelector(".card__like-count"),p=a.querySelector(".card__image");return p.src=n.link,p.alt=n.name,a.querySelector(".card__title").textContent=n.name,null!==(e=n.likes)&&void 0!==e&&e.length&&(f.textContent=null===(s=n.likes)||void 0===s?void 0:s.length),n.owner._id===r?(u.dataset.cardId=n._id,u.addEventListener("click",o)):u.style.display="none",l.addEventListener("click",i),d.addEventListener("click",c),a}function E(t){g.dataset.cardId=t.target.dataset.cardId,n("delete-card")}function C(t){var e;t.target.classList.contains("card__like-button_is-active")?function(t){return m({url:"/cards/likes/".concat(t),method:"DELETE"})}(t.target.dataset.cardId).then(function(e){t.target.classList.remove("card__like-button_is-active"),t.target.nextElementSibling.textContent=e.likes.length||""}).catch(function(t){return console.error(t)}):(e=t.target.dataset.cardId,m({url:"/cards/likes/".concat(e),method:"PUT"})).then(function(e){t.target.classList.add("card__like-button_is-active"),t.target.nextElementSibling.textContent=e.likes.length}).catch(function(t){return console.error(t)})}var L=document.forms["edit-profile"],q=document.forms["edit-avatar"],x=document.querySelector(".profile__title"),O=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),P=L.elements.name,w=L.elements.description,A=q.elements.link;function I(){n("edit-avatar"),A.value="",o(q,u)}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}L.addEventListener("submit",function(t){var e;t.preventDefault(),t.submitter.textContent="Сохранение...",(e={name:P.value,about:w.value},m({url:"/users/me",method:"PATCH",body:JSON.stringify(e)})).then(function(t){x.textContent=t.name,O.textContent=t.about,r()}).catch(function(t){return console.error(t)}).finally(function(){t.submitter.textContent="Сохранить"})}),q.addEventListener("submit",function(t){var e;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=A.value,m({url:"/users/me/avatar",method:"PATCH",body:JSON.stringify({avatar:e})})).then(function(t){j.style.backgroundImage="url(".concat(t.avatar,")"),r()}).catch(function(t){return console.error(t)}).finally(function(){t.submitter.textContent="Сохранить"})});var T,B=document.querySelector(".profile__edit-button"),M=document.querySelector(".profile__add-button"),N=document.querySelector(".profile__avatar"),J=document.querySelector(".profile__avatar-button"),V=document.querySelector(".popup__image"),G=document.querySelector(".popup__caption");function H(t){V.src=t.target.src,V.alt=t.target.alt,G.textContent=t.target.alt,n("image")}Promise.all([m({url:"/users/me",method:"GET"}),m({url:"/cards",method:"GET"})]).then(function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,c,a=[],u=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];x.textContent=o.name,O.textContent=o.about,j.style.backgroundImage="url(".concat(o.avatar,")"),T=o._id,i.forEach(function(t){y.append(k({data:t,profileId:o._id,onDelete:E,onLike:C,onPhotoClick:H}))})}).catch(function(t){return console.log(t)}),B.addEventListener("click",function(){n("edit"),P.value=x.textContent,w.value=O.textContent,o(L,u)}),M.addEventListener("click",function(){n("new-card"),b.value="",h.value="",o(_,u)}),N.addEventListener("click",I),J.addEventListener("click",I),_.addEventListener("submit",function(t){var e;t.preventDefault(),t.submitter.textContent="Сохранение...",(e={name:b.value,link:h.value},m({url:"/cards",method:"POST",body:JSON.stringify(e)})).then(function(e){y.prepend(k({data:e,profileId:T,onDelete:E,onLike:C,onPhotoClick:H})),t.target.reset(),r()}).catch(function(t){return console.error(t)}).finally(function(){t.submitter.textContent="Сохранить"})}),S.addEventListener("submit",function(t){t.preventDefault(),t.submitter.textContent="Удаление...";var e=g.dataset.cardId;(function(t){return m({url:"/cards/".concat(t),method:"DELETE"})})(e).then(function(){document.querySelector('.card__delete-button[data-card-id="'.concat(e,'"]')).closest(".card").remove(),r()}).catch(function(t){return console.error(t)}).finally(function(){t.submitter.textContent="Да"})}),function(t){Array.from(document.forms).forEach(function(e){return function(t,e){var n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,u=Array.from(t.querySelectorAll(n)),l=t.querySelector(r);u.forEach(function(e){e.addEventListener("input",function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?c(t,e):i(t,e,e.validationMessage)})(t,e),a(u,l,o)})})}(e,t)})}(u)})();